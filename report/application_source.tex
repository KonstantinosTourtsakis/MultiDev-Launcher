






\section{Ο κώδικας του λογισμικού}

Όπως αναφέρθηκε στην εισαγωγή το παρόν πρόγραμμα έχει γραφεί σε C++. Σκοπός
είναι η δημιουργία μιας desktop εφαρμογής σε Qt6 περιβάλλον η οποία δεν
θα υλοποιεί τις ανάγκες της εφαρμογής και θα αξιοποιεί τους πόρους του
συστήματος για καλύτερες αποδόσεις. Στην συνέχεια θα περιγραφεί ο τρόπος
με τον οποίο λειτουργεί η εφαρμογή αναφέροντας τις σημαντικότερες διαδικασίες
που αναγράφονται σε κώδικα και εξηγούν πως φτάνουμε στο τελικό αποτέλεσμα
που είδαμε προηγουμένως.


\section{Η συνάρτηση main}
Κάθε πρόγραμμα γραμμένο σε C++ ξεκινάει με την συνάρτηση main να αποτελεί το
σημείο εκκίνησης του προγράμματος. Επομένως αξίζει να δούμε αναλυτικότερα τι
συμβαίνει σε αυτό το κομμάτι του κώδικα για να μπορέσουμε να κατανοήσουμε
καλύτερα την ροή και τις ενέργειες του προγράμματος.

\begin{lstlisting}[language=C++, style=cppstyle]
int main(int argc, char* argv[]) 
{
    QApplication app(argc, argv);
    
    ApplicationExplorer explorer(app);
    explorer.setWindowTitle("P2019140 - Konstantinos Tourtsakis");
    explorer.setWindowFlags(Qt::WindowCloseButtonHint | Qt::FramelessWindowHint);
    explorer.resize(800, 600);
    
    // Storing screen resolution
    screen_width = GetSystemMetrics(SM_CXSCREEN);
    screen_height = GetSystemMetrics(SM_CYSCREEN);
    
    explorer.CreateUI();
    
    VirtualKeyboard QKeyboard;
    
    //QKeyboard.setWindowFlags(Qt::WindowCloseButtonHint | Qt::FramelessWindowHint);
    explorer.QKeyboard = &QKeyboard;
    

    explorer.showMaximized();
    return app.exec();
}
\end{lstlisting}

Αρχικά δημιουργείται το αντικείμενο της εφαρμογής που δέχεται τα arguments με τα οποία εκτελέστηκε.
Στην συνέχεια δημιουργείται ένα αντικείμενο τύπου ApplicationExplorer. Το αντικείμενο αυτό αποτελεί
το βασικό παράθυρο της εφαρμογής το οποίο κληρονομεί την κλάση QWidget και χτίζει τα αντικείμενα της
γραφικής διεπαφής. Στην συνέχεια προστίθενται ορισμένα flags στο παράθυρο της εφαρμογής. Μετά αποθηκεύονται
οι διαστάσεις της οθόνης του χρήστη σε global μεταβλητές οι οποίες θα χρησιμεύσουν στην προσαρμογή των
διαστάσεων των στοχείων της γραφικής διεπαφής ανάλογα με τις διαστάσεις της οθόνης. Μετά ακολουθεί η
δημιουργία των γραφικών στοιχείων καλώντας την μέθοδο CreateUI. Η εφαμοργή συνεχίζει με την δημιουργία
ενός ακόμη αντικειμένου. Αυτήν την φορά η κλάση QWidget κληρονομείται από την κλάση VirtualKeyboard
η οποία δημιουργεί και διαχειρίζεται το παράθυρο του εικονικού πληκτρολογίου. Στην συνέχεια δημιουργείται
αντίγραφο της θέσης μνήμης του αντικειμένου αυτού σε μια μεταβλητή της κλάσης του αρχικού παραθύρου με
σκοπό την επικοινωνία μεταξύ των δύο παραθύρων της εφαρμογής κατά την περιήγηση του χρήστη. Τέλος γίνεται
κλήση για προβολή του βασικού παραθύρου της εφαρμογής με τις μέγιστες διαστάσεις παραθύρου και μετά
εκτελείται η επανάληψη της Qt6 εφαρμογής. 


\section{Η κλάση του προγράμματος}


Μια εφαρμογή που αξιοποιεί τo Qt6 περιλαμβάνει αντικείμενα διαφόρων τύπων ώστε να
μπορέσει να λειτουργήσει. Όπως τα περισσότερα στοιχεία της εφαρμογής, έτσι και το
παράθυρο που δημιουργείται για να φιλοξενήσει την γραφική διεπαφή της είναι ένα αντικείμενο. 
Στην προκειμένη περίπτωση κληρονομείται η κλάση QWidget και στην συνέχεια χρησιμοποιείται 
ως βάση για την υλοποίηση της εφαρμογής. Παρακάτω βλέπουμε τον ορισμό των χαρακτηριστικών
της κλάσης και 


\begin{lstlisting}[language=C++, style=cppstyle]

\end{lstlisting}





\subsection{Ο constructor}
Παρακάτω βλέπουμε την υλοποίηση του constructor της εφαρμογής στον οποίο δημιουργείται 
το χρονόμετρο με το οποίο εκτελείται η διεργασία περιήγησης του χειριστηρίου βιντεοπαιχνιδιών.

\begin{lstlisting}[language=C++, style=cppstyle]
class ApplicationExplorer : public QWidget
{
    ApplicationExplorer(QApplication& app, QWidget* parent = nullptr) : QWidget(parent), app(app)
    {
        // Controller task loop - Perform task constantly
        timer = new QTimer(this);
        connect(timer, &QTimer::timeout, this, &ApplicationExplorer::TaskGamepadNavigation);
        timer->start();

    }
};
\end{lstlisting}



\subsection{Η μέθοδος LoadAppData}
Η μέθοδος LoadAppData είναι υπεύθυνη για την αρχικοποίηση του προγράμματος. Τα
δεδομένα που διαχειρίζεται η μέθοδος αυτή είναι ανεξάρτητα από την δραστηριότητα
του χρήστη και φορτώνονται κατά την εκκίνηση της εφαρμογής. Επομένως έχει να 
κάνει με δεδομένα που το πρόγραμμα θα τροποποιήσει το ίδιο κατά την εκτέλεση. 
Ένα από αυτά είναι η αποθήκευση της κατάστασης του προγράμματος για την ανίχνευση 
της πρώτης εκτέλεσης στην οποία ο χρήστης λαμβάνει ένα εισαγωγικό μήνυμα.



\subsection{Η μέθοδος SaveAppData}
Η μέθοδος SaveAppData διαχειρίζεται τα ίδια δεδομένα με την LoadAppData με την μόνη
διαφορά να βρίσκεται στην λειτουργία της. Όπως είναι προφανές, σκοπός της είναι η
αποθήκευση των δεδομένων αυτών.

\subsection{Η μέθοδος LoadProfile}
Η μέθοδος LoadProfile επίσης αρχικοποιεί το πρόγραμμα κατά την εκκίνηση. Όμως η διαφορά
με την LoadAppData είναι πως στην περίπτωση αυτή γίνεται φόρτωση δεδομένων που αφορούν
την εμπειρία του κάθε χρήστη και όχι του προγράμματος. Επομένως, ενώ η μέθοδος LoadAppData
φορτώνει τα ίδια δεδομένα για όλους τους χρήστες, η LoadProfile θα φορτώσει διαφορετικές
τιμές ανάλογα με τις ενέργειες του κάθε χρήστη.

\subsection{Η μέθοδος SaveProfile}
Η μέθοδος SaveProfile είναι η αντίστοιχη της SaveAppData. Σκοπός της είναι η αποθήκευση
των δεδομένων που διαχειρίζεται η LoadProfile.


\subsection{Η μέθοδος OnApplicationExit}
Η μέθοδος αυτή εκτελεί διαδικασίες που πρέπει να πραγματοποιηθούν κατά την έξοδο εκτέλεσης
του προγράμματος. Για παράδειγμα, Η SaveProfile καλείται μέσω αυτής της μεθόδου. Η εκτέλεσή
της γίνεται συνδέοντάς την εφαρμογή και ορίζοντας ως signal το QCoreApplication::aboutToQuit.

\begin{lstlisting}[language=C++, style=cppstyle]
QObject::connect(&app, &QCoreApplication::aboutToQuit, this, &ApplicationExplorer::OnApplicationExit);
\end{lstlisting}

\subsection{Η μέθοδος DirectoryListUpdated}
Η μέθοδος αυτή αρχικά καθαρίζει την λίστα με τις γνωστές εφαρμογές. Καλείται όταν έχει γίνει
κάποια αλλαγή στην λίστα με τα directories και με κάθε προσθήκη ή αφαίρεση directory προσπελαύνει
την λίστα για την ενημέρωση των εφαρμογών που είναι γνωστές στο πρόγραμμα. Η λίστα με τα directories
μπορεί να περιλαμβάνει διευθύνσεις σε μεμονωμένα αρχεία. Επομένως γίνεται έλεγχος. Αν το στοιχείο
είναι directory τότε καλέιται η μέθοδος ExploreDirectoryFiles με την διεύθυνση του directory. Αν
το στοιχείο είναι αρχείο τότε το προσθέτει στην λίστα εφαρμογών.


\subsection{Η μέθοδος ExploreDirectoryFiles}
Η μέθοδος αυτή δέχεται ως είσοδο ένα directory και στην συνέχεια προσπελαύνονται όλα
τα στοιχεία που βρίσκονται σε αυτό. Αν το στοιχείο είναι ένα αρχείο τύπου ".exe", ".lnk"
ή ".url" τότε η μέθοδος το προσθέτει στην λίστα εφαρμογών του χρήστη. Αν ένα στοιχείο 
είναι και αυτό directory τότε γίνεται αναδρομική κλήση της μεθόδου.


\subsection{Η μέθοδος UpdateListWidget}
Η μέθοδος UpdateListWidget δέχεται ως είσοδο μια string λίστα που περιλαμβάνει τις
διευθύνσεις με τις εφαρμογές και μια λίστα με τα αντικείμενα που θα δημιουργηθούν
για την προβολή των εφαρμογών αυτών στην γραφική διεπαφή. Κατά την διαδικασία αυτή
γίνονται ενέργειες σχετικά με την ανάκτηση του εικονιδίου της εφαρμογής και τις
ρυθμίσεις του κάθε χρήστη σχετικά με την συμπερίληψη της επέκτασης του αρχείου ή όχι.

\subsection{Η μέθοδος SearchApplication}
Η μέθοδος αυτή εκτελεί αναζήτηση μέσα στις λίστες εφαρμογών. Δέχεται ως είσοδο ένα
input field από το οποίο θα προέλθει η είσοδος της αναζήτησης, την λίστα αντικειμένων
στην οποία προστίθενται οι εφαρμογές ως στοιχεία για προβολή στην γραφική διεπαφή και
την λίστα με τις διευθύνσεις των εφαρμογών που γνωρίζει το πρόγραμμα. Αφού γίνει ενημέρωση
της λίστας εφαρμογών σύμφωνα με την είσοδο της αναζήτησης, γίνεται τελικά κλήση της 
μεθόδου UpdateListWidget για την ενημέρωση της λίστας αντικειμένων που χρησιμοποιεί
η μέθοδος αναζήτησης. 


\subsection{Η μέθοδος ExecuteApplication}
Η μέθοδος αυτή δέχεται ως είσοδο ένα στοιχείως της λίστας αντικειμένων των εφαρμογών
που προβάλονται στο πρόγραμμα. Αν το αντικείμενο είναι έγκυρο τότε η μέθοδος φροντίζει
για την εκτέλεσή του ανάλογα με την κατάληξη της διεύθυνσης της εφαρμογής. Αμέσως μετά
προσμετρά την εκτέλεση του αρχείου σε ένα QMap με τις δημοφιλείς εφαρμογές που προκύπτουν
από το πλήθος των εκτελέσεων τους.


\subsection{Η μέθοδος UpdatePopularAppsList}
Η μέθοδος UpdatePopularAppsList δημιουργεί μια λίστα από το QMap που αναφέρθηκε στην
μέθοδο ExecuteApplication προηγουμένως. Αυτό που κάνει είναι να ταξινομεί τα αρχεία που
εκτελέστηκαν σε φθίνουσα σειρά. Στην συνέχεια αποθηκεύει τα 10 πιο δημοφιλή αρχεία σε
μια ξεχωριστή string λίστα που στην συνέχεια θα αξιοποιηθεί για την δημιουργία προτάσεων
κατά την αναζήτηση του χρήστη στο input field.


\subsection{Η μέθοδος TaskGamepadNavigation}



\subsection{Η μέθοδος TaskHandleDevicesUICommunication}



\subsection{Η μέθοδος SetupUI}
Η μέθοδος SetupUI είναι από τις πρώτες μεθόδους που καλούνται από την εφαρμογή και
είναι υπεύθυνη για την δημιουργία των στοιχείων της γραφικής διεπαφής και την σωστή
αρχικοποίησή τους.......... 



\subsection{Η μέθοδος ShowCustomContextMenu}
Η μέθοδος αυτή δημιουργεί ένα context menu στο επιλεγμένο στοιχείο της εφαρμογής και
το εμφανίζει όταν γίνει ένα δεξί κλικ από τον χρήστη πάνω σε αυτό. Οι λειτουργίες που
περιλαμβάνει είναι η χειροκίνητη προσθήκη κάποιας εφαρμογής που δεν υπάρχει σε κάποιο
από τα directories που έδωσε ο χρήστης στο πρόγραμμα. Η προσθήκη αυτή γίνεται στην
λίστα με τα directories όπως αναφέρθηκε προηγουμένως. Η δεύτερη ενέργεια που μπορεί
να γίνει από το context menu είναι η προσθήκη/αφαίρεση μιας εφαρμογής στην λίστα των
αγαπημένων εφαρμογών του χρήστη. Η λειτουργία αυτή προσαρμόζεται ανάλογα με την κατάσταση
μιας εφαρμογής (αγαπημένη ή όχι).

\subsection{Η μέθοδος SetupIntroScreen}
Η μέθοδος αυτή καλείται μόνο κατά την πρώτη εκτέλεση του προγράμματος και σκοπός της
είναι η δημιουργία της γραφικής διεπαφής της εισαγωγικής οθόνης στην οποία ο χρήστης
καλοσορίζεται από το πρόγραμμα και καλείται να εισάγει μερικά στοιχεία για την επιτυχή
ολοκλήρωση της αρχικοποίησης του προγράμματος. 


\subsection{Η μέθοδοι SortingChanged και UpdateUIPalette}
Οι δύο αυτές μέθοδοι έχουν παρόμοια λειτουργία, επομένως δεν υπάρχει λόγος να περιγραφούν
σε ξεχωριστές παραγράφους. Και οι δύο δέχονται ένα string για είσοδο και στην συνέχεια
ελέγχουν την τιμή του σε μία δομή επιλογής if...else if. Άνάλογα με την τιμή αυτή εφαρμόζεται
ο κατάλληλος αλγόριθμος ταξινόμησης και η κατάλληλη θεματολογία για τα χρώματα της εφαρμόγης
για την SortingChanged και την UpdateUIPalette αντίστοιχα. Η τιμή εισόδου προέρχεται από
ένα combo box που είναι διαθέσιμο στον χρήστη και τροποποιείται κατά την εκτέλεση.





% VirtualKeyboard class

\section{Η κλάση VirtualKeyboard}

Η κλάση VirtualKeyboard δημιουργεί το αντικείμενο του εικονικού πληκτρολογίου και διαχειρίζεται
τα δεδομένα του. Μέσω της κλάσης αυτής ο χρήστης μπορεί να γράψει ένα κείμενο εισόδου και στην
συνέχεια να το στείλει σε ένα input field (αν χρήσιμοποιεί χειριστήριο βιντεοπαιχνιδιών) ή να 
το αντιγράψει για επικόλληση μέσω του ποντικιού.  


\subsection{Ο constructor της κλάσης}
Ο constructor αυτή της κλάσης αρχικοποιεί το input field στο οποίο θα εμφανιστεί το κείμενο που
πληκτρολογεί ο χρήστης και στην συνέχεια καλεί την CreateKeyboardUI για το χτίσιμο της γραφικής
διεπαφής.


\subsection{Η μέθοδος widgetAt}
Για την ανίχνευση της θέσης στην οποία βρίσκεται χρήστης στο εικονικό πληκτρολόγιο πρέπει να
ανακτηθεί το αντικείμενο το οποίο βρίσκεται στην τωρινή θέση του δείκτη. Επομένως η μέθοδος
αυτή ελέγχει όλες τις θέσεις του δισδιάστατου πλαισίου στο οποίο τοποθετούνται τα εικονικά
πλήκτρα, όπου στην προκειμένη περίπτωση υλοποιούνται ως κουμπιά, ανακτά το αντικείμενο που
βρίσκεται στην θέση αυτή -----------------------------

\subsection{Η μέθοδος SendKeyboardInput}
Η μέθοδος SendKeyboardInput καλείται από το χειριστήριο για την εισαγωγή και αποστολή κειμένου
από το εικονικό πληκτρολόγιο προς το ενεργό input field. Αυτό που κάνει είναι να κρατάει το
τελευταίο ενεργό παράθυρο και στην συνέχεια να φέρνει στο προσκήνιο το παράθυρο του εικονικού
πληκτρολογίου. Κατά την διάρκεια κλήσης της SendKeyboardInput γίνεται έλεγχος για τα κουμπιά
που πιέζονται από τον χρήστη ώστε να ενημερωθεί η γραφική διεπαφή του πληκτρολογίου και να
εμφανιστεί η θέση στην οποία βρίσκεται ο χρήστης πάνω στο πληκτρολόγιο. Όταν ο χρήστης τελειώσει
και πιέσει το κουμπί "Start" του χειριστηρίου το παράθυρο του πληκτρολογίου κρύβεται και στο
προσκήνιο εμφανίζεται το τελευταίο παράθυρο που κράτησε η εφαρμογή. Τέλος στέλνεται το input
στο παράθυρο και εισάγεται στο input field.



\subsection{Η μέθοδος CreateKeyboardUI}

Η μέθοδος αυτή είναι υπεύθυνη για την δημιουργία της γραφικής διεπαφής του εικονικού πληκτρολογίου.
Αρχικά δημιουργεί τα απαραίτητα πλαίσια και στην συνέχεια προσθέτει τα κατάλληλα κουμπιά με βάση
έναν πίνακα που περιλαμβάνει το σχέδιο του πληκτρολογίου. Το σχήμα του UI είναι βασισμένο στο
σχήμα πληκτρολογίου QWERTY.






\begin{lstlisting}[language=C++, style=cppstyle]
\end{lstlisting}